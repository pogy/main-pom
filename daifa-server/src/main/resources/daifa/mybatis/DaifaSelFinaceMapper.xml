<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.opentae.data.daifa.interfaces.DaifaSelFinaceMapper">

    <select id="selectTodayTakeGoods" resultType="java.lang.String">
        select sum(t.single_pi_price) from(
            select
              t1.df_order_id,
              t1.single_pi_price
            from
              daifa_wait_send_order t1,
              daifa_ggoods t2 ,
              daifa_order t3
            where
              t1.take_goods_status=1
              and t1.df_order_id=t2.df_order_id
              and t1.df_order_id=t3.df_order_id
              and t1.seller_id=${sellerId}
              and t2.take_goods_date=${day}
              and (
                (
                  t3.refund_status=0
                  and t3.return_goods_status =0
                )
                or (
                  t3.return_goods_status !=0
                  and (
                    t3.return_goods_finish_time is null
                    or date_format(t3.return_goods_finish_time,"%Y%m%d")!=${day}
                  )
                )
              )
            GROUP BY t1.df_order_id
        )t
    </select>

    <select id="selectTodayTakeGoods" resultType="java.lang.String">
        SELECT
          sum(t.single_pi_price)
        FROM
        (
            SELECT
              *, MIN(take_goods_status) minStatus
            FROM
              daifa_ggoods_tasks
            WHERE
              create_date = ${day}
              and seller_id=${sellerId}
            GROUP BY
              df_order_id
        ) t
        WHERE
        t.minStatus != 1
    </select>

    <select id="selectTodayServerFee" resultType="java.lang.String">
        

    </select>

</mapper>
