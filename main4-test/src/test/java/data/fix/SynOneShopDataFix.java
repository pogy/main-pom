package data.fix;

import com.opentae.core.mybatis.utils.FieldUtil;
import com.opentae.data.mall.beans.*;
import com.opentae.data.mall.examples.*;
import com.opentae.data.mall.interfaces.*;
import com.shigu.main4.common.util.BeanMapper;
import com.shigu.main4.common.util.DateUtil;
import com.shigu.tb.finder.services.TaobaoSynService;
import org.apache.commons.lang3.StringUtils;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.LinkedBlockingQueue;

/**
 * Created by wxc on 2017/3/26.
 *
 * @author wxc
 * @version domwiki 4.0.0
 * @since domwiki 4.0.0
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:ac.xml")
public class SynOneShopDataFix {

    private static final Logger logger = LoggerFactory.getLogger(SynOneShopDataFix.class);

    @Autowired
    private ShiguShopMapper shiguShopMapper;

    @Autowired
    private ShiguStoreMapper shiguStoreMapper;

    @Autowired
    private ShiguGoodsTinyMapper shiguGoodsTinyMapper;

    @Autowired
    private ShiguGoodsExtendsMapper extendsMapper;

    @Autowired
    private ShiguGoodsSoldoutMapper shiguGoodsSoldoutMapper;

    @Autowired
    private TaobaoSynService taobaoSynService;
    private static final LinkedBlockingQueue<List<ShiguShop>> queue = new LinkedBlockingQueue<>();

    List<ShiguShop> shiguShops = new ArrayList<>();

    @Test
    public void fixData() throws InterruptedException {

        List<CheckItem> items = new ArrayList<>();
        for (int i = 0; i < 20; i++) {
            CheckItem item = new CheckItem();
            items.add(item);
            Thread tr = new Thread(item, "woker-" + i);
            tr.start();
        }

        ShiguShopExample shopExample = new ShiguShopExample();
        int i;
        int size = 50;
        shopExample.setEndIndex(size);
        shopExample.setStartIndex(i = 0);
        shopExample.createCriteria().andShopStatusEqualTo(0);
        List<ShiguShop> shiguShops;
        while (!(shiguShops = shiguShopMapper.selectFieldsByConditionList(shopExample, FieldUtil.codeFields("shop_id, web_site,tb_nick"))).isEmpty()) {
            queue.put(shiguShops);
            shopExample.setStartIndex(i += size);
        }

        while (true) {
            if (queue.isEmpty()) {
                boolean exit = true;
                for (CheckItem item : items) {
                    exit &= item.free;
                }
                if (exit) break;
            }
            Thread.sleep(5000);
            logger.info("queue_size:" + queue.size());
        }
    }

    class CheckItem implements Runnable {
        public boolean free;

        @Override
        public void run() {
            while (true) {
                free = true;
                try {
                    List<ShiguShop> take = queue.take();
                    free = false;
                    for (ShiguShop shop : take) {
                        if (StringUtils.isEmpty(shop.getTbNick()))
                            continue;
                        ShiguGoodsTinyExample tinyExample = new ShiguGoodsTinyExample();
                        tinyExample.setWebSite(shop.getWebSite());
                        tinyExample.createCriteria().andStoreIdEqualTo(shop.getShopId());
                        List<ShiguGoodsTiny> tinies
                                = shiguGoodsTinyMapper.selectFieldsByExample(tinyExample, FieldUtil.codeFields("goods_id"));
                        List<Long> goodsIds = BeanMapper.getFieldList(tinies, "goodsId", Long.class);
                        if (!goodsIds.isEmpty()) {
                            ShiguGoodsExtendsExample extendsExample = new ShiguGoodsExtendsExample();
                            extendsExample.setWebSite(shop.getWebSite());
                            extendsExample.createCriteria().andGoodsIdIn(goodsIds).andGoodsDescIsNull();
                            List<ShiguGoodsExtends> extendses
                                    = extendsMapper.selectFieldsByExample(extendsExample, FieldUtil.codeFields("goods_id"));
                            if (!extendses.isEmpty()) {
                                goodsIds = BeanMapper.getFieldList(extendses, "goodsId", Long.class);
                                ShiguGoodsTinyExample shiguGoodsTinyExample = new ShiguGoodsTinyExample();
                                shiguGoodsTinyExample.setWebSite(shop.getWebSite());
                                shiguGoodsTinyExample.createCriteria().andGoodsIdIn(goodsIds);

                                ShiguGoodsTiny tiny = new ShiguGoodsTiny();
                                tiny.setModified(DateUtil.stringToDate("2000-01-01", "yyyy-MM-dd"));
                                shiguGoodsTinyMapper.updateByExampleSelective(tiny, shiguGoodsTinyExample);
                                try {
                                    taobaoSynService.synOneShop(shop.getShopId(), shop.getTbNick());
                                } catch (Exception e) {
                                    e.printStackTrace();
                                }
                            }
                        }
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                }

            }
        }
    }

    //68669,68677,68685,68692,68702,68710,68720,68729,68737,68743,68751,68763,68770,68780,68787,68794,68802,68810,68817,68824,68831,68839,68848,68857,68865,68873,68881,68888,68897,68907,68916,68924,68932,68941,68948,68957,68966,68978,68985,68993,69002,69009,69018,69027,69034,69043,69050,69060,69068,69075,69082,69090,69098,69105,69113,69122,69130,69137,69147,70557,70564,71042,72842,74147,94308,94316,94322,94330,94337,94348,94364,94373,94383,94416,94424,94453,94467,94475,94499,94508,94516,94523,94560,94576,94587,94597,94626,94647,94655,94679,94689,94708,94717,94725,94748,94782,94806,94817,94832,94840,94862,94868,94881,94896,94911,94934,94943,94951,94974,94982,94989,94999,95006,95021,95040,95049,95055,95066,95084,95090,95100,95109,95118,95125,95134,95148,95158,95168,95176,95182,95198,95213,95224,95238,95261,104169,115013,120783,120786,123047,128997,129722,131236,133133,135124,135125,137351,137353,137355,137540,140361,143196,143201,143203,148056,152277,153060,153065,155545,155550,155554,155561,155567,156568,160301,160307,160312,160318,160324,160330,160336,160343,160349,160355,160361,160366,160371,160376,160380,160385,160390,160395,160400,160406,160412,160419,160425,160431,160437,160444,160451,160459,160468,160474,160481,160489,160495,160499,160506,160512,160519,160526,160530,160539,160545,160550,160556,160563,160572,160578,160586,160589,160596,160603,160611,160618,160624,160630,160635,160639,160645,160651,160658,160661,160667,160672,160679,160684,160689,160694,160701,160706,160712,160717,160721,160726,160731,160736,160740,160744,160748,160752,160755,160760,160763,160767,160773,160779,160783,160789,160796,160801,160806,160810,160816,160824,160830,160837,160843,160850,160855,160861,160866,160872,160888,160893,160898,160902,160906,160910,160913,160917,160922,160927,160932,160936,160940,160943,160947,160951,160954,160959,160964,160969,160974,160976,160979,160982,160985,160988,160991,160992,160995,160998,161001,161004,161006,161010,161011,161015,161016,161021,161023,161027,161029,161034,161036,161040,161042,161045,161051,161056,161062,161066,161071,161076,161079,161084,161089,161093,161099,161103,161108,161111,161116,161119,161123,161126,161131,161132,161136,161141,161145,161149,161152,161156,161160,161163,161167,161169,161173,161175,161180,161183,161188,161192,161199,161203,161206,161209,161213,161216,161220,161223,161227,161230,161235,163664,163668,163673,163679,163683,163688,163692,163698,163703,163708,163715,163722,163727,167624,167629,167637,167641,167647,167653,167660,167665,167671,167678,167683,167688,167693,167698,167704,167709,167716,167722,167726,167732,167738,167744,167751,167757,168682,170855,173581,173649,175161,175937,176066,176348,177371,177406,177416,178253,179956,182447,182455,182459,182467,183102,183110,183117,183351,183355,183359,184641,191107,191110,191114,191119,191125,191128,193774,196608,196629,198247,198334,198545,198550,198556,198561,198563,198564,198566,198568,198570,198572,198573,198575,198579,198584,198591,198596,198602,198606,198611,198615,198619,198623,198626,198630,198637,198640,198644,198647,198651,198654,198658,198662,198667,198671,198673,198677,198680,198685,198690,198694,198698,198704,198710,198715,198718,198725,198729,198734,198742,198748,198758,198761,198767,198773,198778,198784,198788,198793,198798,198804,198817,198825,198830,198836,198843,198849,198852,198863,198869,198874,198881,198888,198893,198900,198909,198914,198921,198930,198937,198942,198947,198951,198955,199346,202051,203507,205275,207762,207766,207770,207774,207778,207784,207788,207795,207799,207803,207807,207812,207817,207821,207826,207830,207834,207839,207843,207848,207851,207853,207858,207862,207866,207871,207876,207880,207884,207888,207893,207902,207907,208097,208101,208104,208107,208112,208115,208118,208122,208127,208132,208137,208143,208147,208151,208154,208158,208162,208166,208169,208173,208176,208181,208184,208188,209908,210411,210427,214187,215226,223185,223188,223189,223193,223196,223200,223204,223207,223211,223214,223216,223219,223223,223228,223230,223233,223237,223241,223245,223249,223252,223254,223258,223261,223265,223269,223272,223276,224254,226868,227224,227227,227230,227236,227239,227241,227244,227247,227250,227253,227254,227256,227259,227262,227265,227269,227272,227274,227277,227279,227282,228303,228306,228308,228311,231967,233093,238670,238672,241489,253536,254308,254348,254641,257948,257950,257951,257953,257955,257956,257958,257960,257961,257963,257965,257966,257968,259246,259247,263481,263789,263790,263791,263792,263793,263794,263795,263796,263797,263798,263799,263801,263802,263803,264415,264879,264880,264881,266996,267039,267413,268365,268367,268369,268371,268373,268374,268376,268377,268378,268379,269050,269053,269055,271479,271482,271484,271486,271489,271491,271494,271496,271498,271501,271502,271505,271508,271511,271512,271515,271517,271518,271521,271524,271526,271529,271531,271533,271535,271538,271540,271543,271544,271547,271550,271552,271555,271557,271560,271562,271565,271567,271569,271572,271574,271576,271579,271581,271583,271585,271588,271592,271595,271598,271601,271603,271605,271607,272324,272325,272327,272329,272330,272332,272394,272396,272398,272399,272401,272403,272405,274636,279701,282113,282120,282123,283487,283491,284771,284774,284777,284780,284785,284788,284885,284892,284895,284899,284904,284908,284914,284922,285785,285986,286719,286750,286932,286934,286936,286938,286939,286941,286943,286944,286948,286949,286951,286952,286954,286956,286958,286961,286963,292651,292654,292656,292658,292659,292661,292663,292665,292666,292669,292670,293092,293094,293921,295871,295872,295874,295876,295877,295879,295881,295882,295884,295886,295887,295889,295890,295892,295894,295896,295897,295899,295901,295902,295904,295905,295907,295909,296706,297511,297513,297516,297518,298843,298845,298846,298848,298849,298851,298853,298854,298856,299946,301400,301563,301565,302181,302182,302183,302184,302185,302186,302187,302188,302189,302190,302191,302192,302193,302194,302195,302196,302197,302198,302199,302200,302201,302202,302203,302204,302254,302256,302258,302259,302261,302263,302264,302266,302268,302270,302272,302273,302275,302277,302278,302280,302281,302283,302285,302287,302288,304591,304592,304593,304594,304595,305064,307811,307814,307816,307819,307821,307823,307825,307828,307830,307832,307834,307836,307838,307840,307843,307845,307847,307849,307851,307854,307857,307859,307862,307864,307866,307870,307872,307874,307877,307879,307881,307883,307886,307890,307893,307895,307897,307899,307901,307903,307906,307908,307910,307913,307915,307918,307920,307922,307925,307927,307929,307933,307934,307936,307939,307941,307943,307949,307951,307953,307955,307957,307959,307961,307964,307965,307967,307970,307972,307974,307976,307979,307981,307983,307985,307987,307989,307991,307992,307993,307994,307996,307998,308000,308002,308004,308006,308008,308010,308013,308015,308017,308019,308021,308262,308303,308305,308309,308312,308315,308317,308318,308320,308743,308744,308746,308748,308750,308751,308753,308754,308756,309186,309875,309877,309878,309879,309880,309882,309884,309885,309887,309889,309890,309891,309893,309894,309895,309897,309899,309900,309902,309903,309904,309905,309906,309907,309908,309910,309911,309913,309915,309917,309918,309920,309922,309923,309925,309927,309929,309930,309932,309933,309935,309937,309939,309941,309942,309944,309946,309947,309949,309951,309952,309953,309954,309956,309958,309959,309961,309963,309965,309966,309969,309970,309972,309974,309976,309977,309979,309981,309983,309984,309986,309988,309992,309993,309994,309996,310011,310013,310014,310016,310017,310018,310019,310020,310070,310071,310072,310073,311209,311210,311212,311214,311216,311218,311219,311221,311692,311694,311696,311697,311699,311701,311702,312681,312682,312685,312687,312689,312691,312693,312695,312697,312699,312701,312704,312706,312708,315647,318117,318119,318124,318126,318128,318328,318729,319934,319935,319937,321826,321827,322979,322980,322983,325526,325533,325538,325542,326912,327127,327861,327865,327869,327873,327875,327880,328740,329091,329098,329105,329107,329113,329115,329120,329125,329129,329134,329137,329142,329145,329147,329154,329159,329162,329164,329166,329171,329182,329189,329193,329198,329199,329203,329206,329210,329213,329215,329219,329223,329225,329229,329230,329233,329236,329238,329242,329246,329248,329251,329253,329255,329258,329260,329264,329268,329270,329273,329274,329277,329280,329281,329284,329287,329290,329292,329294,329296,329298,329299,329301,329304,329305,329307,329309,329311,329313,329839,329844,329848,329853,329858,329861,329865,329868,330398,330779,331507,331997,332538,333477,333482,333483,333485,333486,333489,333491,333494,333682,333685,333768,333788,333845,333849,333857,333869,333871,333896,333902,333904,333906,333934,333935,333936,333937,333938,333939,333941,333942,333944,336057,336066,336070,336091,336108,336494,337893,337895,337897,337899,338384,338514,338947,339464,339466,339468,339469,339471,339472,339474,339476,339478,339482,339483,339485,339486,339488,339490,339492,340862,340864,340865,340867,340869,340871,340872,340874,340876,340878,340880,340882,340883,340885,340887,340888,340890,340892,340893,340895,340897,340898,340900,340902,340903,340905,340907,340908,340910,340912,340914,343664,343666,343668,343669,343671,343673,343675,343677,343678,343680,343682,343684,343685,343687,343689,343690,343692,343869,344072,344103,344110,344131,344143,344185,344193,344195,344197,344631,345985,345986,345989,345991,345992,345994,345996,345998,346000,346001,346003,346005,346006,346008,346010,346011,346013,346014,346016,346017,346020,346021,346023,346025,346026,346028,346029,346034,346035,346037,346039,346041,346043,346045,346049,346051,346053,346057,346059,346060,346062,346063,346065,346067,346068,346070,346071,346072,346073,346074,346076,346078,346079,346082,346084,346086,346088,346090,346092,346094,346095,346097,346099,346101,346103,346104,346105,346107,346108,346110,346112,346113,346115,346117,346119,346120,346122,346124,346126,346128,346130,346132,346133,346135,346137,346139,346141,346144,346145,346148,346150,346152,346154,346156,346158,346160,346162,346163,346165,346169,346171,346172,346174,346176,346178,346182,346184,346186,346188,346190,346192,346194,346196,346199,346201,346203,346205,346207,346209,346211,346213,346215,346217,346219,346222,346224,346225,346227,346229,346231,346233,346238,346239,346241,346243,346245,346247,346249,346250,346251,346252,346253,346254,346257,346258,346260,346262,346264,346266,346268,346269,346271,346273,346276,346278,346279,346281,346285,346287,346289,346291,346292,346295,346296,346297,346299,346301,346303,346305,346307,346309,346313,346315,346317,346319,346320,346322,346324,346325,346326,346328,346330,346332,346336,346338,346339,346343,346345,346349,346351,346353,346355,346356,346358,346362,346364,346366,346367,346371,346373,346375,346377,346379,346382,346383,346385,346387,346389,346391,346393,346396,346398,346400,346402,346404,346406,346407,346409,346411,346413,346415,346417,346419,346423,346425,346426,346427,346429,346431,346433,346435,346437,346439,346441,346443,346445,346447,346448,346449,346450,346451,346452,346454,346456,346458,346460,346462,346463,346465,346467,346471,346473,346475,346477,346479,346481,346483,346485,346487,346488,346491,346492,346494,346496,346498,346499,346501,346503,346505,346508,346510,346511,346513,346515,346517,346519,346521,346523,346525,346526,346527,346529,346531,346533,346535,346537,346539,346541,346543,346545,346546,346548,346550,346552,346553,346555,346557,346559,346561,346563,346565,346567,346569,346571,346573,346575,346577,346579,346580,346581,346583,346585,346587,346589,346591,346593,346594,346596,346597,346598,346600,346602,346605,346607,346609,346611,346613,346615,346617,346619,346621,346623,346625,346627,346629,346631,346633,346634,346636,346638,346639,346641,346642,346643,346644,346645,346646,346648,346650,346652,346654,346655,346657,346660,346661,346664,346665,346669,346671,346673,346675,346677,346679,346680,346682,346684,346686,346688,346690,346692,346694,346697,346698,346700,346702,346704,346706,346708,346710,346712,349510,354628,354664,354811,354917,354976,355170,355178,355209,355211,355225,355227,355229,355232,355234,355289,355377,358667,358668,358669,358670,358671,358672,358673,358674,358675,358676,358677,358678,360665,360797,363283,363290,363294,363297,363302,363305,363308,363312,363315,364119,364137,369173,369189,369369,369371,369373,369392,369397,369435,369841,369851,369854,369882,369911,369932,370027,370148,370152,370153,370155,370159,370161,370205,370234,370285,370290,370306,370319,370330,370397,370585,370613,370730,370732,370734,370743,370746,370834,370850,370874,370921,370923,370925,370927,370929,370931,370934,370936,370951,370953,370954,370955,370956,370957,370975,370990,370992,370994,371007,371009,371010,371012,371014,371105,371116,371124,371146,371179,371330,371335,371337,371339,371341,371343,371345,371347,376316,376635,376947,377590,377675,378170,378171,378173,378175,378177,378178,378180,378181,378183,378185,378186,378187,378188,378189,378191,378193,378197,378198,378199,378201,378202,378204,378205,378206,378208,378210,378212,378213,378215,378217,378219,378220,378222,378224,378225,378227,378229,378230,378232,378234,378236,378237,378239,378241,378242,378244,378246,378247,378249,378251,378253,378254,378256,378257,378259,378260,378262,378264,378266,378267,378269,378271,378273,378276,378278,378280,378281,378283,378285,378286,378288,378290,378292,378293,378295,378297,378298,378300,378302,378303,378305,378306,378308,378309,378310,378312,378314,378315,378317,378318,378320,378322,378323,378325,378326,378328,378329,378331,378333,378334
    String hzDescGoodsIds = "68669,68677,68685,68692,68702,68710,68720,68729,68737,68743,68751,68763,68770,68780,68787,68794,68802,68810,68817,68824,68831,68839,68848,68857,68865,68873,68881,68888,68897,68907,68916,68924,68932,68941,68948,68957,68966,68978,68985,68993,69002,69009,69018,69027,69034,69043,69050,69060,69068,69075,69082,69090,69098,69105,69113,69122,69130,69137,69147,70557,70564,71042,72842,74147,94308,94316,94322,94330,94337,94348,94364,94373,94383,94416,94424,94453,94467,94475,94499,94508,94516,94523,94560,94576,94587,94597,94626,94647,94655,94679,94689,94708,94717,94725,94748,94782,94806,94817,94832,94840,94862,94868,94881,94896,94911,94934,94943,94951,94974,94982,94989,94999,95006,95021,95040,95049,95055,95066,95084,95090,95100,95109,95118,95125,95134,95148,95158,95168,95176,95182,95198,95213,95224,95238,95261,104169,115013,120783,120786,123047,128997,129722,131236,133133,135124,135125,137351,137353,137355,137540,140361,143196,143201,143203,148056,152277,153060,153065,155545,155550,155554,155561,155567,156568,160301,160307,160312,160318,160324,160330,160336,160343,160349,160355,160361,160366,160371,160376,160380,160385,160390,160395,160400,160406,160412,160419,160425,160431,160437,160444,160451,160459,160468,160474,160481,160489,160495,160499,160506,160512,160519,160526,160530,160539,160545,160550,160556,160563,160572,160578,160586,160589,160596,160603,160611,160618,160624,160630,160635,160639,160645,160651,160658,160661,160667,160672,160679,160684,160689,160694,160701,160706,160712,160717,160721,160726,160731,160736,160740,160744,160748,160752,160755,160760,160763,160767,160773,160779,160783,160789,160796,160801,160806,160810,160816,160824,160830,160837,160843,160850,160855,160861,160866,160872,160888,160893,160898,160902,160906,160910,160913,160917,160922,160927,160932,160936,160940,160943,160947,160951,160954,160959,160964,160969,160974,160976,160979,160982,160985,160988,160991,160992,160995,160998,161001,161004,161006,161010,161011,161015,161016,161021,161023,161027,161029,161034,161036,161040,161042,161045,161051,161056,161062,161066,161071,161076,161079,161084,161089,161093,161099,161103,161108,161111,161116,161119,161123,161126,161131,161132,161136,161141,161145,161149,161152,161156,161160,161163,161167,161169,161173,161175,161180,161183,161188,161192,161199,161203,161206,161209,161213,161216,161220,161223,161227,161230,161235,163664,163668,163673,163679,163683,163688,163692,163698,163703,163708,163715,163722,163727,167624,167629,167637,167641,167647,167653,167660,167665,167671,167678,167683,167688,167693,167698,167704,167709,167716,167722,167726,167732,167738,167744,167751,167757,168682,170855,173581,173649,175161,175937,176066,176348,177371,177406,177416,178253,179956,182447,182455,182459,182467,183102,183110,183117,183351,183355,183359,184641,191107,191110,191114,191119,191125,191128,193774,196608,196629,198247,198334,198545,198550,198556,198561,198563,198564,198566,198568,198570,198572,198573,198575,198579,198584,198591,198596,198602,198606,198611,198615,198619,198623,198626,198630,198637,198640,198644,198647,198651,198654,198658,198662,198667,198671,198673,198677,198680,198685,198690,198694,198698,198704,198710,198715,198718,198725,198729,198734,198742,198748,198758,198761,198767,198773,198778,198784,198788,198793,198798,198804,198817,198825,198830,198836,198843,198849,198852,198863,198869,198874,198881,198888,198893,198900,198909,198914,198921,198930,198937,198942,198947,198951,198955,199346,202051,203507,205275,207762,207766,207770,207774,207778,207784,207788,207795,207799,207803,207807,207812,207817,207821,207826,207830,207834,207839,207843,207848,207851,207853,207858,207862,207866,207871,207876,207880,207884,207888,207893,207902,207907,208097,208101,208104,208107,208112,208115,208118,208122,208127,208132,208137,208143,208147,208151,208154,208158,208162,208166,208169,208173,208176,208181,208184,208188,209908,210411,210427,214187,215226,223185,223188,223189,223193,223196,223200,223204,223207,223211,223214,223216,223219,223223,223228,223230,223233,223237,223241,223245,223249,223252,223254,223258,223261,223265,223269,223272,223276,224254,226868,227224,227227,227230,227236,227239,227241,227244,227247,227250,227253,227254,227256,227259,227262,227265,227269,227272,227274,227277,227279,227282,228303,228306,228308,228311,231967,233093,238670,238672,241489,253536,254308,254348,254641,257948,257950,257951,257953,257955,257956,257958,257960,257961,257963,257965,257966,257968,259246,259247,263481,263789,263790,263791,263792,263793,263794,263795,263796,263797,263798,263799,263801,263802,263803,264415,264879,264880,264881,266996,267039,267413,268365,268367,268369,268371,268373,268374,268376,268377,268378,268379,269050,269053,269055,271479,271482,271484,271486,271489,271491,271494,271496,271498,271501,271502,271505,271508,271511,271512,271515,271517,271518,271521,271524,271526,271529,271531,271533,271535,271538,271540,271543,271544,271547,271550,271552,271555,271557,271560,271562,271565,271567,271569,271572,271574,271576,271579,271581,271583,271585,271588,271592,271595,271598,271601,271603,271605,271607,272324,272325,272327,272329,272330,272332,272394,272396,272398,272399,272401,272403,272405,274636,279701,282113,282120,282123,283487,283491,284771,284774,284777,284780,284785,284788,284885,284892,284895,284899,284904,284908,284914,284922,285785,285986,286719,286750,286932,286934,286936,286938,286939,286941,286943,286944,286948,286949,286951,286952,286954,286956,286958,286961,286963,292651,292654,292656,292658,292659,292661,292663,292665,292666,292669,292670,293092,293094,293921,295871,295872,295874,295876,295877,295879,295881,295882,295884,295886,295887,295889,295890,295892,295894,295896,295897,295899,295901,295902,295904,295905,295907,295909,296706,297511,297513,297516,297518,298843,298845,298846,298848,298849,298851,298853,298854,298856,299946,301400,301563,301565,302181,302182,302183,302184,302185,302186,302187,302188,302189,302190,302191,302192,302193,302194,302195,302196,302197,302198,302199,302200,302201,302202,302203,302204,302254,302256,302258,302259,302261,302263,302264,302266,302268,302270,302272,302273,302275,302277,302278,302280,302281,302283,302285,302287,302288,304591,304592,304593,304594,304595,305064,307811,307814,307816,307819,307821,307823,307825,307828,307830,307832,307834,307836,307838,307840,307843,307845,307847,307849,307851,307854,307857,307859,307862,307864,307866,307870,307872,307874,307877,307879,307881,307883,307886,307890,307893,307895,307897,307899,307901,307903,307906,307908,307910,307913,307915,307918,307920,307922,307925,307927,307929,307933,307934,307936,307939,307941,307943,307949,307951,307953,307955,307957,307959,307961,307964,307965,307967,307970,307972,307974,307976,307979,307981,307983,307985,307987,307989,307991,307992,307993,307994,307996,307998,308000,308002,308004,308006,308008,308010,308013,308015,308017,308019,308021,308262,308303,308305,308309,308312,308315,308317,308318,308320,308743,308744,308746,308748,308750,308751,308753,308754,308756,309186,309875,309877,309878,309879,309880,309882,309884,309885,309887,309889,309890,309891,309893,309894,309895,309897,309899,309900,309902,309903,309904,309905,309906,309907,309908,309910,309911,309913,309915,309917,309918,309920,309922,309923,309925,309927,309929,309930,309932,309933,309935,309937,309939,309941,309942,309944,309946,309947,309949,309951,309952,309953,309954,309956,309958,309959,309961,309963,309965,309966,309969,309970,309972,309974,309976,309977,309979,309981,309983,309984,309986,309988,309992,309993,309994,309996,310011,310013,310014,310016,310017,310018,310019,310020,310070,310071,310072,310073,311209,311210,311212,311214,311216,311218,311219,311221,311692,311694,311696,311697,311699,311701,311702,312681,312682,312685,312687,312689,312691,312693,312695,312697,312699,312701,312704,312706,312708,315647,318117,318119,318124,318126,318128,318328,318729,319934,319935,319937,321826,321827,322979,322980,322983,325526,325533,325538,325542,326912,327127,327861,327865,327869,327873,327875,327880,328740,329091,329098,329105,329107,329113,329115,329120,329125,329129,329134,329137,329142,329145,329147,329154,329159,329162,329164,329166,329171,329182,329189,329193,329198,329199,329203,329206,329210,329213,329215,329219,329223,329225,329229,329230,329233,329236,329238,329242,329246,329248,329251,329253,329255,329258,329260,329264,329268,329270,329273,329274,329277,329280,329281,329284,329287,329290,329292,329294,329296,329298,329299,329301,329304,329305,329307,329309,329311,329313,329839,329844,329848,329853,329858,329861,329865,329868,330398,330779,331507,331997,332538,333477,333482,333483,333485,333486,333489,333491,333494,333682,333685,333768,333788,333845,333849,333857,333869,333871,333896,333902,333904,333906,333934,333935,333936,333937,333938,333939,333941,333942,333944,336057,336066,336070,336091,336108,336494,337893,337895,337897,337899,338384,338514,338947,339464,339466,339468,339469,339471,339472,339474,339476,339478,339482,339483,339485,339486,339488,339490,339492,340862,340864,340865,340867,340869,340871,340872,340874,340876,340878,340880,340882,340883,340885,340887,340888,340890,340892,340893,340895,340897,340898,340900,340902,340903,340905,340907,340908,340910,340912,340914,343664,343666,343668,343669,343671,343673,343675,343677,343678,343680,343682,343684,343685,343687,343689,343690,343692,343869,344072,344103,344110,344131,344143,344185,344193,344195,344197,344631,345985,345986,345989,345991,345992,345994,345996,345998,346000,346001,346003,346005,346006,346008,346010,346011,346013,346014,346016,346017,346020,346021,346023,346025,346026,346028,346029,346034,346035,346037,346039,346041,346043,346045,346049,346051,346053,346057,346059,346060,346062,346063,346065,346067,346068,346070,346071,346072,346073,346074,346076,346078,346079,346082,346084,346086,346088,346090,346092,346094,346095,346097,346099,346101,346103,346104,346105,346107,346108,346110,346112,346113,346115,346117,346119,346120,346122,346124,346126,346128,346130,346132,346133,346135,346137,346139,346141,346144,346145,346148,346150,346152,346154,346156,346158,346160,346162,346163,346165,346169,346171,346172,346174,346176,346178,346182,346184,346186,346188,346190,346192,346194,346196,346199,346201,346203,346205,346207,346209,346211,346213,346215,346217,346219,346222,346224,346225,346227,346229,346231,346233,346238,346239,346241,346243,346245,346247,346249,346250,346251,346252,346253,346254,346257,346258,346260,346262,346264,346266,346268,346269,346271,346273,346276,346278,346279,346281,346285,346287,346289,346291,346292,346295,346296,346297,346299,346301,346303,346305,346307,346309,346313,346315,346317,346319,346320,346322,346324,346325,346326,346328,346330,346332,346336,346338,346339,346343,346345,346349,346351,346353,346355,346356,346358,346362,346364,346366,346367,346371,346373,346375,346377,346379,346382,346383,346385,346387,346389,346391,346393,346396,346398,346400,346402,346404,346406,346407,346409,346411,346413,346415,346417,346419,346423,346425,346426,346427,346429,346431,346433,346435,346437,346439,346441,346443,346445,346447,346448,346449,346450,346451,346452,346454,346456,346458,346460,346462,346463,346465,346467,346471,346473,346475,346477,346479,346481,346483,346485,346487,346488,346491,346492,346494,346496,346498,346499,346501,346503,346505,346508,346510,346511,346513,346515,346517,346519,346521,346523,346525,346526,346527,346529,346531,346533,346535,346537,346539,346541,346543,346545,346546,346548,346550,346552,346553,346555,346557,346559,346561,346563,346565,346567,346569,346571,346573,346575,346577,346579,346580,346581,346583,346585,346587,346589,346591,346593,346594,346596,346597,346598,346600,346602,346605,346607,346609,346611,346613,346615,346617,346619,346621,346623,346625,346627,346629,346631,346633,346634,346636,346638,346639,346641,346642,346643,346644,346645,346646,346648,346650,346652,346654,346655,346657,346660,346661,346664,346665,346669,346671,346673,346675,346677,346679,346680,346682,346684,346686,346688,346690,346692,346694,346697,346698,346700,346702,346704,346706,346708,346710,346712,349510,354628,354664,354811,354917,354976,355170,355178,355209,355211,355225,355227,355229,355232,355234,355289,355377,358667,358668,358669,358670,358671,358672,358673,358674,358675,358676,358677,358678,360665,360797,363283,363290,363294,363297,363302,363305,363308,363312,363315,364119,364137,369173,369189,369369,369371,369373,369392,369397,369435,369841,369851,369854,369882,369911,369932,370027,370148,370152,370153,370155,370159,370161,370205,370234,370285,370290,370306,370319,370330,370397,370585,370613,370730,370732,370734,370743,370746,370834,370850,370874,370921,370923,370925,370927,370929,370931,370934,370936,370951,370953,370954,370955,370956,370957,370975,370990,370992,370994,371007,371009,371010,371012,371014,371105,371116,371124,371146,371179,371330,371335,371337,371339,371341,371343,371345,371347,376316,376635,376947,377590,377675,378170,378171,378173,378175,378177,378178,378180,378181,378183,378185,378186,378187,378188,378189,378191,378193,378197,378198,378199,378201,378202,378204,378205,378206,378208,378210,378212,378213,378215,378217,378219,378220,378222,378224,378225,378227,378229,378230,378232,378234,378236,378237,378239,378241,378242,378244,378246,378247,378249,378251,378253,378254,378256,378257,378259,378260,378262,378264,378266,378267,378269,378271,378273,378276,378278,378280,378281,378283,378285,378286,378288,378290,378292,378293,378295,378297,378298,378300,378302,378303,378305,378306,378308,378309,378310,378312,378314,378315,378317,378318,378320,378322,378323,378325,378326,378328,378329,378331,378333,378334";

    @Test
    public void updateThatItem() throws Exception {
        String[] sites = {
                "hz",
                "cs",
                "bb",
                "bj",
                "gz",
                "jf",
                "jx",
                "ss",
                "wa",
                "xh",
        };

        for (String site : sites) {
            long start = System.currentTimeMillis();
            logger.info("\n\nsite:" + site + ", 扫描商品详情为null");
            ShiguGoodsExtendsExample extendsExample = new ShiguGoodsExtendsExample();
            extendsExample.setWebSite(site);
            extendsExample.createCriteria().andGoodsDescIsNull();
            List<ShiguGoodsExtends> extendses = extendsMapper.selectFieldsByExample(extendsExample, FieldUtil.codeFields("goods_id"));

            List<Long> goodsIds = BeanMapper.getFieldList(extendses, "goodsId", Long.class);
            logger.info(site + "： 得到商品ID");
            if (goodsIds.isEmpty())
                continue;

            ShiguGoodsTinyExample tinyExample = new ShiguGoodsTinyExample();
            tinyExample.createCriteria().andGoodsIdIn(goodsIds);


            tinyExample.setWebSite(site);
            ShiguGoodsTiny tiny = new ShiguGoodsTiny();
            tiny.setModified(DateUtil.stringToDate("2000-01-01", "yyyy-MM-dd"));
            shiguGoodsTinyMapper.updateByExampleSelective(tiny, tinyExample);
            logger.info("执行修改商品淘宝修改时间. 本次耗时：" + (System.currentTimeMillis() - start) + "ms");
        }

    }

    @Test
    public void csModified() {
        String ssIDs = "693569,694354,694501,694510,694511,694512,694514,694524,694548,694549,694585,694625,694637,694647,694667,695047,695127,695634,697752,697753,697754,697755,697756,698822,698840,698878,698892,698948,698984,699065,711057,711215,717127,717132,717164,717537,727841,734695,742980,756273,760245,760256,760718,760726,760745,761830,761840,761841,762434,762468,762778,762860,777742,777745,777751,777756,778765,780947,780979,780987,780991,780997,781001,781012,781041,781043,781064,782166,782171,785379,785482,789974,791561,791563,791564,791569,791571,791606,791623,791632,791637,791645,791650,791655,791661,791700,791721,791731,791736,791745,791748,791749,791751,791770,791773,791829,791839,792122,792130,792196,792201,792265,792268,792275,792289,792302,792471,792489,793455,795847,795856,798059,798111,798469,798475,798486,798487,798489,798517,798526,798564,801424,801435,801456,801458,801462,801516,801531,801609,803531,803634,805822,805839,806999,807011,807031,807033,807037,807098,807114,807165,808321,808330,810025,810289,810332,811395,811755,811757,811758,811761,811763,811765,811769,811779,811784,811806,811811,811816,811889,811891,811893,811960,815154,815164,815182,815184,815188,815232,815320,815365,815663,815785,818935,818945,818959,818961,818965,819000,819082,819125,821803,821855,823599,824786,824791,824797,824931,827052,827074,832238,832249,836041,836058,836103,836105,837283,837285,837289,837293,849179,849198,849349,849396,849407,857433,857442,857443,857901,860539,860541,860547,860562,860571,860572,860578,860610,860629,881307,881315,884928,884973,892829,892833,892836,892837,892839,892841,892842,892848,892849,892851,892855,892856,892860,892861,892866,892868,892869,892872,892873,892874,892876,892877,892879,892881,892883,892884,892886,892889,892892,892894,892895,892897,892899,892900,892902,892904,892908,892912,892913,892914,892916,892918,892920,892922,892924,892927,892932,892935,892937,892938,892942,892944,892945,892947,892949,892951,892958,892963,892964,892969,892973,892975,892980,892984,892989,892990,892995,893002,893003,893012,893013,893015,893018,893023,893025,893028,893030,893032,893036,893045,893047,893053,893055,893060,893061,893062,893070,893071,893072,893074,893077,893080,893083,893089,893090,893091,893097,893100,893103,893105,893109,893116,893118,893123,893138,893140,893144,893147,893150,893155,893159,893160,893161,893166,893169,893192,893196,893197,893198,893199,893202,893230,895521,895523,895525,895529,895531,895533,895535,895537,895539,895544,895548,895550,895552,895556,895558,895560,895562,895669,896557,896565,896646,898784,899333,900497,902212,902213,902214,902215,902216,902217,902218,902219,905951,907999,908001,908017,908018,908020,908021,908033,908042,908047,908053,908057,908060,908065,908066,908079,908081,908082,908120,908132,908139,909276,909906,912996,913493,913495,913497,913499,913501,913503,913504,913506,913508,913510,913514,913516,913522,913528,913529,913530,913532,913537,913545,913549,913552,913582,913584,913604,913609,913618,913637,913644,913651,913670,913696,913702,913706,913720,913722,913761,913782,913786,913793,913817,913825,913837,913867,913989,914027,914209,915878,922429,936766,937796,937799,937803,937804,937809,937811,937813,937814,937818,937820,937822,937823,937827,937828,937829,937830,937833,937834,937838,937839,937840,937841,937842,937843,937849,937851,937855,937858,937859,937860,937864,937869,937874,937876,937878,937879,937880,937884,937886,937893,937897,937902,937903,937907,937908,937913,937921,937924,937925,937928,937936,937942,937948,937958,938344,938346,938348,938553,939284,939310,939410,954580,954581,954582,954584,954586,954587,954588,954589,954591,954592,954593,954594,954595,954597,954598,954601,954604,954605,954606,954611,954612,954614,954615,954616,954620,954622,954623,954624,954625,954627,954629,954630,954634,954639,954641,954642,954643,954644,954645,954651,954654,954657,954659,954667,954674,954675,954677,954678,954679,954680,954681,954682,954684,954685,954687,954689,954690,954691,954697,954699,954700,954701,954703,954704,954706,954707,954708,954710,954712,954714,954719,954720,954722,954726,954728,954729,954731,954735,954737,954738,954739,954740,954741,954742,954743,954745,954746,954749,954753,954756,954757,954761,954762,954764,954766,954767,954769,954772,954774,954778,954779,954780,954786,954791,954792,954795,954796,954797,954798,954805,954806,954808,954813,954814,954817,954820,954821,954826,954827,954829,954831,954833,954837,954838,954841,954844,954847,954849,954851,954853,954854,954859,954860,954861,954865,954869,954870,954871,954877,954878,954881,954882,954885,954894,954896,954898,954900,954902,954904,954912,954920,954922,954925,954926,954927,954928,954929,954930,954934,954935,954940,954942,954944,954945,954951,954952,954955,954957,954961,954963,954964,954966,954969,954976,954977,954981,954984,954986,954987,954994,954997,954998,955000,955003,955005,955016,955017,955018,955020,955027,955029,955030,955031,955032,955036,955042,955046,955049,955054,955060,955065,955071,955072,955077,955080,955085,955092,955094,955095,955098,955101,955102,955104,955105,955106,955108,955109,955111,955112,955116,955120,955125,955126,955127,955128,955130,955131,955132,955133,955135,955138,955140,955141,955145,955146,955147,955148,955150,955152,955153,955157,955159,955161,955162,955163,955166,955167,955168,955169,955171,955173,955174,955176,955181,955182,955191,955192,955193,955197,955200,955201,955204,955205,955206,955208,955213,955214,955218,955222,955226,955231,955232,955238,955242,955244,955245,955249,955253,955255,955259,955261,955270,955272,955274,955275,955277,955279,955280,955281,955282,955283,955284,955286";
        List<Long> ids = new ArrayList<>(1000);
        for (String s : ssIDs.split(",")) {
            ids.add(Long.valueOf(s));
        }

        ShiguGoodsTinyExample tinyExample = new ShiguGoodsTinyExample();
        tinyExample.setWebSite("cs");
        tinyExample.createCriteria().andGoodsIdIn(ids);
        ShiguGoodsTiny tiny = new ShiguGoodsTiny();
        tiny.setModified(DateUtil.stringToDate("2000-01-01", "yyyy-MM-dd"));
        shiguGoodsTinyMapper.updateByExampleSelective(tiny, tinyExample);

        ShiguGoodsSoldoutExample soldoutExample = new ShiguGoodsSoldoutExample();
        soldoutExample.setWebSite("cs");
        soldoutExample.createCriteria().andGoodsIdIn(ids);
        ShiguGoodsSoldout soldout = new ShiguGoodsSoldout();
        soldout.setModified(DateUtil.stringToDate("2000-01-01", "yyyy-MM-dd"));
        shiguGoodsSoldoutMapper.updateByExampleSelective(soldout, soldoutExample);
    }

    @Test
    public void showHzModifiedItem() {
        ShiguGoodsTinyExample tinyExample = new ShiguGoodsTinyExample();
        tinyExample.setWebSite("gz");
        tinyExample.createCriteria().andModifiedEqualTo(DateUtil.stringToDate("2000-01-01", "yyyy-MM-dd"));
        List<Long> shopIds = new ArrayList<>();
        for (ShiguGoodsTiny tiny : shiguGoodsTinyMapper.selectFieldsByExample(tinyExample, FieldUtil.codeFields("goods_id, store_id"))) {
            shopIds.add(tiny.getStoreId());
        }
        ShiguShopExample shopExample = new ShiguShopExample();
        shopExample.createCriteria().andShopIdIn(shopIds);
        System.out.println("\n\n");
        for (ShiguShop shop : shiguShopMapper.selectByExample(shopExample)) {
            System.out.println("shopMap.put(" + shop.getShopId() + "L, \"" + shop.getTbNick() + "\");");
        }
    }
}
